- content_for :on_ready_hook do
  - user_names = User.limit(10).collect { |user| "@#{user.name}" }
  :plain
    var names = #{user_names.to_json};
    $(".textarea textarea").autocomplete({source: names});
    $("#new_conversation").ajaxForm({dataType: 'script', resetForm: true, iframe: true, data: {xhr: true}});
    $("a.attachment_icon").click(function() {
      $(".upload_area").toggle();
      return false;
    });
    (function() {
      var template = '<input type="file" name="conversation[replies_attributes][0][uploads_attributes][{{number}}][asset]" class="fresh" />';
      $(".upload_area input.fresh").live('change', function() {
        $(this).removeClass('fresh');
        $(".upload_area").append(template.replace('{{number}}', $(".upload_area input").size()));
      });
    })();

#project_panel_wrap
  .column_wrap
    #project_logo
      - if @project.logo?
        = image_tag @project.logo.medium.url
      - else
        = image_tag @project.logo.medium.default_url
  .content_wrap
    = render 'shared/project_menu'
    - new_conversation = @project.conversations.build
    = form_for [@project, new_conversation], :html => {:multipart => true} do |f|
      - new_conversation.replies.build
      = f.fields_for :replies do |reply_form|
        = render 'replies/fields', :f => reply_form, :project => @project
      .submit
        = f.submit
